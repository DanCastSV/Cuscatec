{% load static %}
<link rel="stylesheet" href="{% static 'css/navbar.css' %}">
<nav class="ct-navbar" role="navigation" aria-label="Barra principal">
  <div class="ct-container">

    <!-- BRAND -->
    <div class="brand">
      <a href="{% url 'inicio' %}" class="brand-link">
        <img src="{% static 'images/logo.png' %}" alt="Cuscatec" class="brand-logo">
        <span class="brand-name">Cuscatec</span>
      </a>
    </div>

    

    <!-- USER MENU -->
    <div class="user-area">
      <button id="user-btn" class="user-btn" aria-haspopup="true" aria-expanded="false">
        {{ user.get_full_name|default:user.username }}
        <span class="caret">▾</span>
      </button>

      <div id="user-menu" class="user-menu" role="menu" aria-hidden="true">
        <a href="#" role="menuitem">Perfil</a>
        <a href="#" role="menuitem">Configuración</a>
        <div class="separator" role="separator"></div>
        <button type="button" class="menu-item logout-item" onclick="logout()">Cerrar sesión</button>
      </div>
    </div>

  </div>
</nav>

<!-- FORM LOGOUT -->
<form id="logout-form" action="{% url 'logout' %}" method="post" style="display:none;">
  {% csrf_token %}
</form>

<script>
  (function(){
    const userBtn = document.getElementById('user-btn');
    const userMenu = document.getElementById('user-menu');

    function closeMenu(){
      userMenu.classList.remove('show');
      userBtn.setAttribute('aria-expanded','false');
      userMenu.setAttribute('aria-hidden','true');
    }

    function openMenu(){
      userMenu.classList.add('show');
      userBtn.setAttribute('aria-expanded','true');
      userMenu.setAttribute('aria-hidden','false');
    }

    userBtn.addEventListener('click', function(e){
      e.stopPropagation();
      userMenu.classList.contains('show') ? closeMenu() : openMenu();
    });

    document.addEventListener('click', function(e){
      if(!userMenu.contains(e.target) && !userBtn.contains(e.target)){
        closeMenu();
      }
    });

    document.addEventListener('keydown', function(e){
      if(e.key === "Escape") closeMenu();
    });

    window.logout = function(){
      document.getElementById("logout-form").submit();
    };
  })();
</script>
